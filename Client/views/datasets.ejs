<%- include('components/navbar') %>

<div class="container">
  <h1>Datasets</h1>
  <p>Explore the available datasets below.</p>

  <div class="row">
    <% datasets.forEach(dataset => { %>
      <% if (dataset.heading && dataset.author) { %>  <!-- Check if the dataset has necessary fields -->
        <div class="col-md-4 position-relative">
          <%- include('components/card', {
            item: {
              heading: dataset.heading,
              author: dataset.author,
              retrieval_link: dataset.retrieval_link,  // External link if provided
              imageUrl: dataset.imageUrl || '/img/default.jpg'  // Use default image if none is provided
            }
          }) %>

          <% if (user && user.userType === 'admin') { %>
            <!-- Delete button or X mark for admins -->
            <form action="/datasets/<%= dataset.id %>/delete" method="POST" class="delete-form">
              <button type="submit" class="btn btn-danger btn-sm position-absolute" style="top: 10px; right: 10px;">
                &times;
              </button>
            </form>
          <% } %>
        </div>
      <% } %>
    <% }); %>
  </div>
</div>

<script>
  // Add a confirmation dialog before submitting the delete form
  document.querySelectorAll('.delete-form').forEach(form => {
    form.addEventListener('submit', function(event) {
      if (!confirm('Are you sure you want to delete this dataset? This action cannot be undone.')) {
        event.preventDefault(); // Prevent form submission if not confirmed
      }
    });
  });
</script>
